openapi: 3.0.3
info:
  title: Dire Matching Engine REST API
  description: |
    REST API for order submission, cancel, modify, and admin. See project_docs/api_documentation.md for WebSocket and FIX.
  version: 0.1.0
servers:
  - url: http://localhost:8080
    description: Local default
paths:
  /health:
    get:
      summary: Liveness
      operationId: health
      responses:
        '200':
          description: OK
          content:
            text/plain:
              schema:
                type: string
                example: ok
  /orders:
    post:
      summary: Submit order
      operationId: submitOrder
      description: Requires trader role when auth enabled. Returns 503 when market is not Open.
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Order'
      responses:
        '200':
          description: Order accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized (missing or invalid API key)
        '503':
          description: Market not open
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /orders/cancel:
    post:
      summary: Cancel order
      operationId: cancelOrder
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order_id]
              properties:
                order_id:
                  type: integer
                  format: uint64
      responses:
        '200':
          description: Cancel result
          content:
            application/json:
              schema:
                type: object
                properties:
                  canceled:
                    type: boolean
        '401':
          description: Unauthorized
  /orders/modify:
    post:
      summary: Modify (replace) order
      operationId: modifyOrder
      description: Returns 503 when market is not Open.
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order_id, replacement]
              properties:
                order_id:
                  type: integer
                  format: uint64
                replacement:
                  $ref: '#/components/schemas/Order'
      responses:
        '200':
          description: Modify result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
        '503':
          description: Market not open
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /admin/status:
    get:
      summary: Admin status
      description: Requires admin or operator role.
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
        '403':
          description: Forbidden (trader role)
  /admin/market-state:
    get:
      summary: Get market state
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  state:
                    type: string
                    enum: [Open, Halted, Closed]
    post:
      summary: Set market state
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [state]
              properties:
                state:
                  type: string
                  enum: [Open, Halted, Closed]
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  state:
                    type: string
        '400':
          description: Invalid state value
        '403':
          description: Forbidden
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API key
      description: API key as Bearer token
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key in header
  schemas:
    Order:
      type: object
      required:
        - order_id
        - client_order_id
        - instrument_id
        - side
        - order_type
        - quantity
        - time_in_force
        - timestamp
        - trader_id
      properties:
        order_id:
          type: integer
          format: uint64
        client_order_id:
          type: string
        instrument_id:
          type: integer
          format: uint64
        side:
          type: string
          enum: [Buy, Sell]
        order_type:
          type: string
          enum: [Limit, Market]
        quantity:
          oneOf:
            - type: string
            - type: number
        price:
          oneOf:
            - type: string
            - type: number
            - type: 'null'
          description: Required for Limit orders
        time_in_force:
          type: string
          enum: [GTC, IOC, FOK]
        timestamp:
          type: integer
          format: uint64
        trader_id:
          type: integer
          format: uint64
    OrderResponse:
      type: object
      properties:
        trades:
          type: array
          items:
            $ref: '#/components/schemas/Trade'
        reports:
          type: array
          items:
            $ref: '#/components/schemas/ExecutionReport'
    ExecutionReport:
      type: object
      properties:
        order_id:
          type: integer
        exec_id:
          type: integer
        exec_type:
          type: string
          enum: [New, PartialFill, Fill, Canceled, Rejected]
        order_status:
          type: string
          enum: [New, PartiallyFilled, Filled, Canceled, Rejected]
        filled_quantity:
          oneOf: [{ type: string }, { type: number }]
        remaining_quantity:
          oneOf: [{ type: string }, { type: number }]
        avg_price:
          oneOf: [{ type: string }, { type: number }, { type: 'null' }]
        last_qty:
          oneOf: [{ type: string }, { type: number }, { type: 'null' }]
        last_px:
          oneOf: [{ type: string }, { type: number }, { type: 'null' }]
        timestamp:
          type: integer
    Trade:
      type: object
      properties:
        trade_id:
          type: integer
        instrument_id:
          type: integer
        buy_order_id:
          type: integer
        sell_order_id:
          type: integer
        price:
          oneOf: [{ type: string }, { type: number }]
        quantity:
          oneOf: [{ type: string }, { type: number }]
        timestamp:
          type: integer
        aggressor_side:
          type: string
          enum: [Buy, Sell]
    Error:
      type: object
      properties:
        error:
          type: string
